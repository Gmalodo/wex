version: '2'

# We use intensive files concatenation and service extensions
# in order to keep as possible a minimum of services definition in websites
# and let to pick and control expected container.
# See wexample::site/compose to see concatenation method detail.

services:

    web:
        container_name: '${SITE_NAME}_web'
        image: 'wexample/php7:latest'
        ports:
            - '80:80'
        stdin_open: true
        tty: true
        volumes:
         # Site folder
         - ${SITE_PATH_ROOT}:/var/www/html
         # Apache
         - ${SITE_PATH_ROOT}docker/apache/site.conf:/etc/apache2/sites-available/000-default.conf
         # Mysql dumps
         - ${SITE_PATH_ROOT}dumps:/var/dumps

    mysql:
        container_name: '${SITE_NAME}_mysql'
        image: 'wexample/mysql:latest'
        ports:
            - '3306:3306'
        environment:
            - MYSQL_ROOT_PASSWORD=${SITE_DB_PASSWORD}
            - MYSQL_DATABASE=${SITE_DB_NAME}
            - MYSQL_USER=root
            - MYSQL_PASSWORD=${SITE_DB_PASSWORD}
        volumes:
            - ${SITE_PATH_ROOT}/mysql:/var/lib/mysql

    phpmyadmin:
        container_name: '${SITE_NAME}_phpmyadmin'
        image: phpmyadmin/phpmyadmin
        container_name: phpmyadmin
        environment:
          - PMA_HOST=${SITE_NAME}_mysql
        restart: always
        ports:
          - '9001:80'
